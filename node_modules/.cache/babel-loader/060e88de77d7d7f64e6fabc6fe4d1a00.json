{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/skyle/Desktop/PoSWE/cs4278-group3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"C:/Users/skyle/Desktop/PoSWE/cs4278-group3/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/skyle/Desktop/PoSWE/cs4278-group3/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/Users/skyle/Desktop/PoSWE/cs4278-group3/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/skyle/Desktop/PoSWE/cs4278-group3/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\skyle\\\\Desktop\\\\PoSWE\\\\cs4278-group3\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";/**\r\n * Group 3\r\n * Homework 3\r\n * Grant Bowlds (grant.f.bowlds@vanderbilt.edu) \r\n * Donny Carr (donovan.e.carr@vanderbilt.edu) \r\n * Justin Condren (justin.l.condren@vanderbilt.edu)\r\n * Skyler Grandel (skyler.h.grandel@vanderbilt.edu)\r\n */import React from'react';import NavBar from'../components/NavBar';import{Form,Button,Alert,Spinner}from'react-bootstrap';import Airtable from'airtable';/**\r\n * This is the calendar page with two calendars: a sales calendar and a event calendar\r\n * The calendars are next to each other so users can see both calendars in the same view\r\n * It includes a Google Calendar integration\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CAL=/*#__PURE__*/function(_React$Component){_inherits(CAL,_React$Component);var _super=_createSuper(CAL);function CAL(){_classCallCheck(this,CAL);return _super.apply(this,arguments);}_createClass(CAL,[{key:\"render\",value:function render(){/** Calendar for existing events */return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"iframe\",{src:\"https://airtable.com/embed/shrUeUoHKI6Tbowma?backgroundColor=purple&viewControls=on\",width:1000,height:533,title:\"events calendar\"})});}}]);return CAL;}(React.Component);var ACTCAL=/*#__PURE__*/function(_React$Component2){_inherits(ACTCAL,_React$Component2);var _super2=_createSuper(ACTCAL);function ACTCAL(){_classCallCheck(this,ACTCAL);return _super2.apply(this,arguments);}_createClass(ACTCAL,[{key:\"render\",value:function render(){/** Sales calendar */return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"iframe\",{src:\"https://airtable.com/embed/shrFBCTmc1ADoYCEO?backgroundColor=purple&viewControls=on\",width:1000,height:533,title:\"sales calendar\"})});}}]);return ACTCAL;}(React.Component);var Calendar=/*#__PURE__*/function(_React$Component3){_inherits(Calendar,_React$Component3);var _super3=_createSuper(Calendar);function Calendar(){var _this;_classCallCheck(this,Calendar);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super3.call.apply(_super3,[this].concat(args));_this.state={//google info\nclientId:\"\",apiKey:\"\",discoveryDocs:[],scope:\"\",// state for Gcal form\noptions:[],// list of clients that a user could be reminded about\nallOptions:[],selectedOptions:[],// clients currently selected by user\nsearch:'',// current contents of the search bar\ndate:'',// date the user should be reminded\nopenForm:false,// state to see if the form should be visible\nerror:''};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// get the data from airtable then assign it to this.state.options\n_this.getData().then(function(arr){_this.setState({options:arr,allOptions:arr,// google api information\nclientId:\"1075606334020-sdhvje80qvau18224tlqfb0g1gb5dqeb.apps.googleusercontent.com\",apiKey:process.env.REACT_APP_GKEY,discoveryDocs:[\"https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest\"],scope:\"https://www.googleapis.com/auth/calendar.events\"});}).then(function(){// debugging\nconsole.log(\"options: \",_this.state.options);console.log(_this.state.options[0]);});case 1:case\"end\":return _context.stop();}}},_callee);}));_this.getData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var retArr,base;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:retArr=[];// array to hold values from db\nbase=new Airtable({apiKey:process.env.REACT_APP_ATKEY}).base('appECiA8jbyRdHrbu');// access db\n// from the CRM-Prospects table, access all entries\nbase('CRM-Prospects').select({view:\"All Contacts\"}).eachPage(function page(records,fetchNextPage){// This function (`page`) will get called for each page of records.\n// get the name, org, and email of each contact in the table and concat them into a string \n// then append it to the array\nrecords.forEach(function(record){var name=record.get('Name & organization');var email=record.get('Email');if(name&&email){// if either field is undefined, don't add it\nretArr.push(name+' ('+email+')');}});// To fetch the next page of records, call `fetchNextPage`.\n// If there are more records, `page` will get called again.\n// If there are no more records, `done` will get called.\nfetchNextPage();}).then(function(err){if(err){console.error(err);return;}_this.setState({openForm:true});});return _context2.abrupt(\"return\",retArr);case 4:case\"end\":return _context2.stop();}}},_callee2);}));_this.onSelectedOptionsChange=function(e){// this gets the item that was clicked in the multiselect form\nvar selection=[].slice.call(e.target.selectedOptions).map(function(item){return item.value;})[0];// if it was already selected, remove it, otherwise, add it to the list of selected options\nif(_this.state.selectedOptions.includes(selection)){_this.setState({selectedOptions:_this.state.selectedOptions.filter(function(e){return e!==selection;})});}else{_this.state.selectedOptions.push(selection);}};_this.formatSelections=function(){var str='';_this.state.selectedOptions.forEach(function(e){str=str.concat('\\n',e);});str=str.concat('\\n\\nSend emails from templates at koacore.co');return str;};_this.handleSubmit=function(e){e.preventDefault();// prevent page reload\nif(_this.state.selectedOptions.length<=0||_this.state.date===''){_this.setState({error:'Please indicate one or more clients and pick a date'});return;}var gapi=window.gapi;// access Google API\n// load client\ngapi.load('client:auth2',function(){gapi.client.load('calendar','v3',function(){return console.log('Client Loaded');});// load calendar api\ngapi.auth2.getAuthInstance().signIn()// access user profile\n.then(function(){//define the event we will post to their calendar\nvar event={'summary':'Reach out to prospective clients','description':'This is a reminder to reach out to the following clients: '+_this.formatSelections(),'start':{'dateTime':_this.state.date+'T09:00:00-05:00'// set the event for 9 to 9:15 central time\n},'end':{'dateTime':_this.state.date+'T09:15:00-05:00'}};// add the event to the user's primary calendar\nvar request=gapi.client.calendar.events.insert({'calendarId':'primary','resource':event});// execute request and log the result\nrequest.execute(function(event){console.log(event);window.open(event.htmlLink);});});});};_this.search=function(e){var newOptions=[];_this.state.allOptions.forEach(function(str){if(str.toLowerCase().includes(e.target.value.toLowerCase())){newOptions.push(str);}});_this.setState({options:newOptions,search:e.target.value});};return _this;}_createClass(Calendar,[{key:\"render\",value:/**\r\n   * Renders the page\r\n   * @returns the page info to render\r\n   */function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(NavBar,{employee:true}),this.state.error!==''&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:this.state.error}),/*#__PURE__*/_jsx(\"h1\",{style:{color:\"#ffffff\"},children:\"Calendar\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:\"auto\",color:\"#ffffff\"},children:\"Events\"}),/*#__PURE__*/_jsx(\"h2\",{style:{margin:\"auto\",color:\"#ffffff\"},children:\"Sales\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[/*#__PURE__*/_jsx(CAL,{}),/*#__PURE__*/_jsx(\"p\",{children:\"\\xA0\"}),/*#__PURE__*/_jsx(ACTCAL,{})]}),/*#__PURE__*/_jsx(\"h2\",{style:{margin:\"auto\",marginTop:\"20px\",marginBottom:\"20px\",color:\"#ffffff\"},children:\"Set a Google Calendar reminder to contact a client\"}),this.state.openForm?/*#__PURE__*/_jsxs(Form,{onSubmit:this.handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:\"80%\",margin:'auto',display:'flex'},children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",style:{width:\"50%\",margin:'auto'},children:[/*#__PURE__*/_jsx(Form.Label,{style:{color:\"#ffffff\"},children:\"Which clients do you want to contact?\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Search\",value:this.state.search,onChange:this.search}),/*#__PURE__*/_jsx(Form.Control,{as:\"select\",size:\"lg\",multiple:true,value:this.state.selectedOptions,onChange:this.onSelectedOptionsChange,style:{height:'200px'},children:this.state.options.map(function(option){return/*#__PURE__*/_jsx(\"option\",{value:option,style:{marginBottom:'10px'},children:option.split('(')[0]},option);})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",style:{width:\"50%\",margin:'auto',marginTop:'0px',marginLeft:'5%'},children:[/*#__PURE__*/_jsx(Form.Label,{style:{color:\"#ffffff\"},children:\"When should you be reminded?\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",size:\"lg\",value:this.state.date,onChange:function onChange(e){return _this2.setState({date:e.target.value});}})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",style:{marginBottom:'80px'},children:\"Add to Google Calendar\"})]}):/*#__PURE__*/_jsx(Spinner,{style:{marginBottom:'80px'},animation:\"border\",variant:\"light\",size:\"lg\"})]});}}]);return Calendar;}(React.Component);export default Calendar;","map":{"version":3,"sources":["C:/Users/skyle/Desktop/PoSWE/cs4278-group3/src/pages/Calendar.js"],"names":["React","NavBar","Form","Button","Alert","Spinner","Airtable","CAL","Component","ACTCAL","Calendar","state","clientId","apiKey","discoveryDocs","scope","options","allOptions","selectedOptions","search","date","openForm","error","componentDidMount","getData","then","arr","setState","process","env","REACT_APP_GKEY","console","log","retArr","base","REACT_APP_ATKEY","select","view","eachPage","page","records","fetchNextPage","forEach","record","name","get","email","push","err","onSelectedOptionsChange","e","selection","slice","call","target","map","item","value","includes","filter","formatSelections","str","concat","handleSubmit","preventDefault","length","gapi","window","load","client","auth2","getAuthInstance","signIn","event","request","calendar","events","insert","execute","open","htmlLink","newOptions","toLowerCase","color","display","alignItems","justifyContent","margin","marginTop","marginBottom","width","height","option","split","marginLeft"],"mappings":"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","sourcesContent":["/**\r\n * Group 3\r\n * Homework 3\r\n * Grant Bowlds (grant.f.bowlds@vanderbilt.edu) \r\n * Donny Carr (donovan.e.carr@vanderbilt.edu) \r\n * Justin Condren (justin.l.condren@vanderbilt.edu)\r\n * Skyler Grandel (skyler.h.grandel@vanderbilt.edu)\r\n */\r\n\r\nimport React from 'react';\r\nimport NavBar from '../components/NavBar';\r\nimport {Form, Button, Alert, Spinner} from 'react-bootstrap';\r\nimport Airtable from 'airtable';\r\n\r\n/**\r\n * This is the calendar page with two calendars: a sales calendar and a event calendar\r\n * The calendars are next to each other so users can see both calendars in the same view\r\n * It includes a Google Calendar integration\r\n */\r\n\r\nclass CAL extends React.Component {\r\n  render() {\r\n    /** Calendar for existing events */\r\n    return (\r\n      <>\r\n      <iframe src=\"https://airtable.com/embed/shrUeUoHKI6Tbowma?backgroundColor=purple&viewControls=on\" \r\n      width={1000} height={533} title=\"events calendar\"/>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nclass ACTCAL extends React.Component {\r\n    render() {\r\n      /** Sales calendar */\r\n      return (\r\n        <>\r\n        <iframe src=\"https://airtable.com/embed/shrFBCTmc1ADoYCEO?backgroundColor=purple&viewControls=on\"\r\n        width={1000} height={533} title=\"sales calendar\"/>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\nclass Calendar extends React.Component {\r\n\r\n  state = {\r\n    //google info\r\n    clientId: \"\",\r\n    apiKey: \"\",\r\n    discoveryDocs: [],\r\n    scope: \"\",\r\n\r\n    // state for Gcal form\r\n    options: [], // list of clients that a user could be reminded about\r\n    allOptions: [],\r\n    selectedOptions: [], // clients currently selected by user\r\n    search: '', // current contents of the search bar\r\n    date: '', // date the user should be reminded\r\n    openForm: false, // state to see if the form should be visible\r\n    error: ''\r\n  }\r\n\r\n  /**\r\n   * Functoin called on initial load it initialize state\r\n   */\r\n  componentDidMount = async() => {\r\n\r\n    // get the data from airtable then assign it to this.state.options\r\n    this.getData().then((arr) =>{\r\n      this.setState({\r\n        options: arr,\r\n        allOptions: arr,\r\n\r\n        // google api information\r\n        clientId: \"1075606334020-sdhvje80qvau18224tlqfb0g1gb5dqeb.apps.googleusercontent.com\",\r\n        apiKey: process.env.REACT_APP_GKEY,\r\n        discoveryDocs: [\"https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest\"],\r\n        scope: \"https://www.googleapis.com/auth/calendar.events\",\r\n      });\r\n    }).then(()=>{\r\n\r\n      // debugging\r\n      console.log(\"options: \", this.state.options);\r\n      console.log(this.state.options[0]); \r\n    })\r\n  }\r\n\r\n  /**\r\n   * Gets the required data from the database\r\n   * @returns An array of strings with name, org, and email of all clients in the db\r\n   */\r\n  getData = async() => {\r\n    var retArr = []; // array to hold values from db\r\n    var base = new Airtable({apiKey: process.env.REACT_APP_ATKEY}).base('appECiA8jbyRdHrbu'); // access db\r\n\r\n    // from the CRM-Prospects table, access all entries\r\n    base('CRM-Prospects').select({\r\n      view: \"All Contacts\"\r\n    }).eachPage(function page(records, fetchNextPage) {\r\n      // This function (`page`) will get called for each page of records.\r\n  \r\n      // get the name, org, and email of each contact in the table and concat them into a string \r\n      // then append it to the array\r\n      records.forEach((record) => {\r\n        var name = record.get('Name & organization');\r\n        var email = record.get('Email');\r\n\r\n        if(name && email){ // if either field is undefined, don't add it\r\n          retArr.push(name + ' (' + email + ')');\r\n        }\r\n      });\r\n  \r\n      // To fetch the next page of records, call `fetchNextPage`.\r\n      // If there are more records, `page` will get called again.\r\n      // If there are no more records, `done` will get called.\r\n      fetchNextPage();\r\n  \r\n    }).then((err) => {\r\n      if (err) { console.error(err); return; }\r\n      this.setState({openForm:true});\r\n    });\r\n\r\n    return retArr;\r\n  }\r\n\r\n  /**\r\n   * Update the selectedOptions variable when user selects new clients\r\n   * or when they want to remove a client from their selection\r\n   * @param {event} e : state change event\r\n   */\r\n  onSelectedOptionsChange = (e) => {\r\n    // this gets the item that was clicked in the multiselect form\r\n    var selection = [].slice.call(e.target.selectedOptions).map(item => item.value)[0];\r\n\r\n    // if it was already selected, remove it, otherwise, add it to the list of selected options\r\n    if(this.state.selectedOptions.includes(selection)){\r\n      this.setState({selectedOptions: this.state.selectedOptions.filter(e => e !== selection)});\r\n    } else {\r\n      this.state.selectedOptions.push(selection);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the selectedOptions array as a formatted string for use in the Gcal event\r\n   * @returns A formatted string\r\n   */\r\n  formatSelections = () => {\r\n    var str = ''\r\n    this.state.selectedOptions.forEach((e)=>{\r\n      str = str.concat('\\n', e);\r\n    });\r\n\r\n    str = str.concat('\\n\\nSend emails from templates at koacore.co')\r\n\r\n    return str;\r\n  }\r\n\r\n  /**\r\n   * On form submit, adds the info given to the user's Google Calendar\r\n   * @param {event} e : form submit event\r\n   * @returns void on invalid submit\r\n   */\r\n  handleSubmit = (e) => {\r\n    e.preventDefault(); // prevent page reload\r\n    if(this.state.selectedOptions.length <= 0 || this.state.date === ''){\r\n      this.setState({error: 'Please indicate one or more clients and pick a date'});\r\n      return;\r\n    }\r\n\r\n    var gapi = window.gapi; // access Google API\r\n\r\n    // load client\r\n    gapi.load('client:auth2', () => {\r\n      gapi.client.load('calendar', 'v3', () => console.log('Client Loaded')) // load calendar api\r\n\r\n      gapi.auth2.getAuthInstance().signIn() // access user profile\r\n      .then(() => {\r\n        \r\n        //define the event we will post to their calendar\r\n        var event = {\r\n          'summary': 'Reach out to prospective clients',\r\n          'description': 'This is a reminder to reach out to the following clients: ' + this.formatSelections(),\r\n          'start': {\r\n            'dateTime': this.state.date + 'T09:00:00-05:00', // set the event for 9 to 9:15 central time\r\n          },\r\n          'end': {\r\n            'dateTime': this.state.date + 'T09:15:00-05:00',\r\n          }\r\n        }\r\n\r\n        // add the event to the user's primary calendar\r\n        var request = gapi.client.calendar.events.insert({\r\n          'calendarId': 'primary',\r\n          'resource': event,\r\n        })\r\n\r\n        // execute request and log the result\r\n        request.execute(event => {\r\n          console.log(event)\r\n          window.open(event.htmlLink)\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  search = (e) => {\r\n    var newOptions = []\r\n    this.state.allOptions.forEach(str => {\r\n      if(str.toLowerCase().includes(e.target.value.toLowerCase())){\r\n        newOptions.push(str);\r\n      }\r\n    });\r\n\r\n    this.setState({options: newOptions, search: e.target.value});\r\n  }\r\n\r\n  /**\r\n   * Renders the page\r\n   * @returns the page info to render\r\n   */\r\n  render(){\r\n      return(\r\n          <div>\r\n              <NavBar employee={true} />\r\n\r\n              {this.state.error !== '' && <Alert variant=\"danger\">{this.state.error}</Alert>}\r\n\r\n              <h1 style={{color:\"#ffffff\"}}>Calendar</h1>\r\n              <div style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n              }}>\r\n                  <h2 style={{margin:\"auto\", color:\"#ffffff\"}}>Events</h2>\r\n                  <h2 style={{margin:\"auto\", color:\"#ffffff\"}}>Sales</h2>\r\n              </div>\r\n              <div style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n              }}>\r\n                  <CAL />\r\n                  <p>&nbsp;</p>\r\n                  <ACTCAL />\r\n              </div>\r\n              \r\n              <h2 style={{margin:\"auto\", marginTop:\"20px\", marginBottom:\"20px\", color:\"#ffffff\"}}>Set a Google Calendar reminder to contact a client</h2>\r\n              {this.state.openForm ? (\r\n                <Form onSubmit={this.handleSubmit}>\r\n    \r\n                    <div style={{width:\"80%\", margin:'auto', display:'flex'}}>\r\n    \r\n                    <Form.Group className='mb-3' style={{width:\"50%\", margin:'auto'}}>\r\n                      <Form.Label style={{color:\"#ffffff\"}}>Which clients do you want to contact?</Form.Label>\r\n                      <Form.Control type=\"text\" placeholder=\"Search\" value={this.state.search} onChange={this.search} />\r\n                      <Form.Control \r\n                      as=\"select\" \r\n                      size='lg' \r\n                      multiple \r\n                      value={this.state.selectedOptions} \r\n                      onChange={this.onSelectedOptionsChange}\r\n                      style={{height:'200px'}}>\r\n                        {this.state.options.map(option => (\r\n                          <option key={option} value={option} style={{marginBottom:'10px'}}>\r\n                            {option.split('(')[0]}\r\n                          </option>\r\n                        ))}\r\n                      </Form.Control>\r\n                    </Form.Group>\r\n    \r\n                    <Form.Group className='mb-3' style={{width:\"50%\", margin:'auto', marginTop:'0px', marginLeft:'5%'}}>\r\n                      <Form.Label style={{color:\"#ffffff\"}}>When should you be reminded?</Form.Label>\r\n                      <Form.Control\r\n                      type=\"date\"\r\n                      size='lg'\r\n                      value={this.state.date}\r\n                      onChange={(e)=>this.setState({date:e.target.value})}\r\n                      />\r\n                    </Form.Group>\r\n    \r\n                    </div>\r\n    \r\n                    <Button variant=\"primary\" type=\"submit\" style={{marginBottom :'80px'}}>\r\n                            Add to Google Calendar\r\n                    </Button>\r\n                  </Form>\r\n              ) : <Spinner style={{marginBottom:'80px'}} animation=\"border\" variant=\"light\" size='lg' />}\r\n\r\n          </div>\r\n          \r\n      );\r\n  }\r\n}\r\n\r\nexport default Calendar;"]},"metadata":{},"sourceType":"module"}